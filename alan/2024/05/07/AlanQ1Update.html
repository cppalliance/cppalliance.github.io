<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Making MrDocs Portable for Every Toolchain | The C++ Alliance</title>
<link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
<!-- Bootstrap core CSS -->
<link href="/css/style.css" rel="stylesheet">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=1">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=1">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=1">
<link rel="manifest" href="/site.webmanifest?v=1">
<link rel="mask-icon" href="/safari-pinned-tab.svg?v=1" color="#a91c20">
<link rel="shortcut icon" href="/favicon.ico?v=1">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#ffffff">
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Making MrDocs Portable for Every Toolchain | The C++ Alliance</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Making MrDocs Portable for Every Toolchain" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Summary MrDocs Boost Libraries Boost Release Tools Boost Website C++ Github Actions MrDocs Over the last quarter, we continued our work on MrDocs, a documentation generator for C++ projects. I have been overseeing and reviewing all the work done by the other contributors to the project. Besides the work done by Krystian and Fernando, George H. (an author of https://github.com/hdoc/hdoc[HDoc]) also joined the project as a contributor. We have been working on making the project at least as competitive as the Doxygen with Docca we have been using with other libraries. The goal is to use it in a subset of Boost libraries that will also use Antora for their documentation. In this process, we have also been improving usability and documentation, considering the feedback we received. Features In particular, work in Q1/2024 included: Updating the LLVM version we have been using and adapting the project to the new version Updating CI workflows to use official releases for all dependencies, which is an essential step in the direction of making the project more stable for user instructions, CI, and standalone binaries Improve the documentation to provide more straightforward installation instructions and examples. New Antora plugins were included to make the documentation more interactive and easier to navigate. A new CI workflow that builds and caches LLVM from source, making it easier to update the LLVM versions and deprecate the old workflow that required manual intervention to update binaries on the MrDocs website Custom scripts and presets for dependencies that do not provide them, such as Duktape and LLVM Adjust CI to replicate the instructions in the documentation and vice-versa precisely. CMake Presets updated to improve the build time and reflect the documentation instructions Work on sanitizing references in Javadoc commands that need to know whether the first argument is an identifier. Clang often provides these references as simple text. Support for multi-node HTML tags: Clang represents several HTML tags by multiple nodes. MrDocs simply ignored these tags, but now they are correctly represented in the DOM. Support for several new Javadoc and (“throws”, “details”, “see”) HTML tags (“br”, “img”, “input”, “hr”, “meta”, “link”, “base”, “area”, “col”, “command”, “embed”, “keygen”, “param”, “source”, “track”, “wbr”). These tags were already present in the Boost.URL documentation, but MrDocs did not support them. Simplify the ASTVisitor by generalizing the traverse function. Provide demos with their mrdocs.yml files and use them instead of generating new ones. This change allows the projects to handle their custom parameters instead of relying on the global configuration. Support input filters to include or exclude files according to their paths. Create a bash argument parser so that mrdocs.yml parameters that represent CMake options can use the same syntax used to call CMake from the command line. Support for automatic CMake execution by MrDocs to generate the compile_commands.json file. This feature was implemented over many commits. Support for C source files. Filter sanitizer flags in the command database. A number of improvements to the C++ Actions project directed at benefiting MrDocs. Dozens of minor bug fixes and improvements to the implementation Binaries While working on these concrete issues, I have also explored strategies to generate stable standalone binaries for MrDocs. The motivation is that it is time-consuming to build MrDocs, so the way MrDocs is supposed to be most commonly used is with scripts that download portable executables and run the tool. These scripts will usually be run in CI on some Ubuntu-X container. The problem is we are using recent versions of Ubuntu (Ubuntu 23.04 now) to originally build MrDocs because of the C++ features we need. However, users (including the Boost Release Tools) usually use earlier versions of Ubuntu (usually from 18.04 to 22.04) for various reasons. Binaries built on Ubuntu X (say 23.04) does not work under Ubuntu &lt;X (say 20.04). For this reason, we need to provide portable executables that people can use. I have researched many complex strategies to solve the problem and have been experimenting with each of them for weeks. Solutions based on -static/-static-libgcc did not work because they still depend on the kernel for libc. Using musl also did not work because using Musl with C++ is complex, and there needs to be a toolchain for the compilers we need. The latest C++/Musl toolchain is GCC 11. Cosmopolitan turned out to be inappropriate for our needs. It is very experimental and attempts to be much more general than we need. GCC -ffreestanding compile mode limits the standard libraries available, which is not an option for MrDocs. A combination of MrDocs downgrading Ubuntu and Boost release tools upgrading Ubuntu. We have already implemented that, but the solution is still not portable enough for Boost let alone other workflows. There is also a limit on how much we can downgrade Ubuntu because of the C++ features we need. For instance, downgrading to 20.04 would require us to compile another compiler from source before building MrDocs: this is overly complex, hard to maintain, slow to test, not general enough, and just failed to work in practice. ApBuild (a gcc wrapper that enforces GLIB_C version and does a few other binary compatibility tricks) was a solution somewhat similar to a wrapper overriding system libraries (see below). However, it has not been maintained , and a custom wrapper is likely to work better. The solution I’m currently exploring is a wrapper overriding system libs. Considering the limitations of the other ideas we have tried, I will explore a strategy similar to APBuild, but one that is manual and more stable. It is also similar to how CMake provides its binaries. It consists of patching the release so that: The libraries required by MrDocs are identified and bundled with the MrDocs release in subdirectories of lib bin/mrdocs is renamed mrdocs.real (or something to this end) A C wrapper is compiled to replace the original bin/mrdocs. This wrapper adjusts the library paths and calls mrdocs.real. It should be compiled with a very old version of GCC and Ubuntu. The wrapper can be compiled once or in CI. This wrapper approach has the following benefits: This wrapper also seemed like a complex solution at first, but it turned out to be much simpler and more effective than the other solutions we tried. It is easy to maintain. We can use the same logic and wrapper no matter what version of Ubuntu we initially used to compile MrDocs. This simplicity also means we have more freedom to upgrade the MrDocs toolchain and use more recent C++ standards. Testing is much easier because these binaries require no specific workflow. The releases would be a patched version of the same binaries we have produced. Also, it involves no custom-built compilers. It is a much more general solution. We can build MrDocs on Ubuntu 23.04 and use the release binaries on Ubuntu 16.04 if we have to. Integrations As Boost.URL keeps integrating MrDocs, it has been inspiring the features we need in MrDocs and is temporarily generating the documentation with both Doxygen+Docca and Antora+MrDocs. The same workflow has also been implemented in Boost.Buffers, which is now inspiring new feature requests, such as the identification of Niebloids and SFINAE constraints in the documentation. General work In general, I’ve been responsible in MrDocs for: setting up and maintaining CI for the project; MrDocs and LLVM release binaries; build scripts; setting up and integrating dependencies; setting up and deploying the Antora toolchains and documentation to the project website; working on supporting libraries; supervising and reviewing the work done by other contributors (Krystian, Fernando, and George H.); and fixing bugs. Handlebars The MrDocs also includes a support library that reimplements the Handlebars template engine in C++. This module is used to generate documentation from templates. The Handlebars library has achieved a stable state and is now used in MrDocs to generate the documentation. It includes C++/JavaScript bindings that work both ways so that users can provide helpers for their templates. We may consider splitting Handlebars into a separate project. Boost Libraries As in other quarters, the Boost Library I have been investing most of my time in is Boost.URL. The library is in maintenance mode since our focus shifted to MrDocs, but there is a constant demand for work fixing bugs and improving the documentation: Multiple commits related to the Antora+MrDocs workflow. Many new tests have been included to improve the library’s coverage, which is now at 99%. Dozens of minor bug fixes and improvements to the implementation, documentation, and CI workflows Many improvements had to be coordinated with the C++ Github Actions project, which implemented new features for these use cases. Many bugs in the actions were also revealed by Boost.HTTP now uses the actions in its CI. In general, I have been responsible for: upgrading CI, primarily coordinating with the C++ Github Actions; maintaining, simplifying, and updating build scripts; integrating more spec tests, such as the Ada tests included more recently; including more examples, such as the more recent sanitize-URL example; fixing documentation content out of date; and fixing bugs. Besides Boost.URL, as usual, I have been overseeing and fixing smaller issues with other boost libraries. I have been also helping Boost.HTTP and Boost.Buffers in their efforts to improve CI and integrate MrDocs. Boost Release Tools I have been working on the integration of toolchains I developed into the Boost Release Tools to add support for features desired for the new Boost website. We needed many improvements to the workflow for Antora support in the release tools, as bugs and inconveniences have been identified since the official Boost release 1.84.0. Antora directories are now patched and moved to another location. We also kept working on an initiative to support archive variants in the release tools. This pull request is still under review and will be considered for inclusion in a period between Boost releases when priority moves from the Boost website. Boost Website Among the many support projects for the new Boost website, I have been helping the most on website-v2-docs, which includes the Boost website documentation as an Antora project. Its components represent the website’s “User Guide,” “Contributor Guide,” and “Formal Review” sections. Since the beginning of the project, I have been overseeing and reviewing the work of the other contributors. In general, I continue to be responsible for: reviewing and merging all pull requests to the project; setting up and maintaining CI for the project; coordinating with the website project on content uploaded to AWS buckets; build scripts to be reused by the release tools and previews; writing sections of the documentation that require technical knowledge; developing custom Boost/Antora extensions, such as the Boost Macro extension; maintaining the Antora toolchain and templates; and adjusted Boost libraries to match formats expected by the website. C++ Github Actions C++ Github Actions is a project I have maintained since 2023. It is a collection of composable, independent, and reusable GitHub Actions for any C++ project that needs to be tested on various compilers and environments. MrDocs, Boost.URL, Boost.HTTP, and Boost.Buffers are currently using these actions in their CI. All of these projects have been allowing us to get more feedback and improve the actions. The project includes actions to: Generate a Github Actions Matrix for C++ projects; Setup C++ compilers; Install and setup packages; Clone Boost modules; Run complete CMake and b2 workflows; Generate changelogs from conventional commits; Generate summaries; and Generate time-trace reports and flame graphs One notable problem with GitHub actions in Q1/2024 is that GitHub decided to update the base version of Node.js to 20. Because Node.Js is not statically linked, this change broke many actions that depended on it. All projects that depend on older containers now get an error related to the appropriate glic version not being found. Attempting to use older versions of Node.js still works temporarily, but it also emits a warning. This bug will need to be addressed in the future. In particular, a number of new features were added to the C++ Actions project in Q1 2024. Boost optimistic caching is now disabled by default. Caching is optional. Expressions in the main workflow to override these parameters. Cmake workflow includes a complete bash command line parser for the CMake arguments. It makes the workflow more reliable as commands are now properly passed through to CMake in a way that matches the user’s expectations. Cmake workflow supports combinatorial variants of extra arguments. For instance, this could be used in integration tests (as has been implemented in Boost.URL) where the same workflow is run with slightly different arguments. CMake setup is cached in the GitHub Actions tool cache. The binary is also added to PATH. All C++ Matrix suggestions are now customizable for ranges of compiler versions. This feature eliminates the need for expressions to override matrix options. C++ Matrix supports custom images. C++ Matrix has a new option for combinatorial factors. Unlike other factors that apply to the latest or an intermediary version of a toolset, combinatorial factors duplicate all entries for a compiler and set a new flag to identify that kind of test. For instance, it could be used to test clang with libc++ and libstdc++ in parallel for each clang version. C++ Matrix includes flags for intermediary compiler versions. These flags are handy when a test does not need to occur in intermediary versions of a compiler that have no unique factors applied to it. C++ Matrix supports composite factors. Composite factors allow two factors to be determined at once for a test. For instance, the factor TSan+Asan will set the flags for both TSan and Asan in the same test, with having to create a test for each. This type of factor is useful when the factors are mutually exclusive. The C++ Matrix uses containers by default when appropriate. In particular, this eliminates errors with Clang, which often picks up an uncommon version of stdlibc++ when running tests. This choice is often an incompatible version that does not represent the most common use case by the user. B2 workflow supports versioned toolsets. For instance, a toolset gcc-13 would appropriately set only gcc in user-config.jam while calling b2 with the appropriate complete flag. B2 workflow support for dozens of options specific to B2. These include options supported by B2 that do not apply to CMake: clean, clean-all, abbreviate-paths (default is true), hash, rebuild-all, dry-run, stop-on-error, config, site-config, user-config, project-config, debug-configuration, debug-building, debug-generators, include, define, and runtime-link. A number of these options have been necessary in other Boost projects using these actions. Package-Install supports add-architecture. Dozens of other minor improvements, bug fixes, and updates to the documentation. In addition to new features, most work has been done to fix issues revealed by testing the actions in new environments. About ~50 bugs with various levels of severity have been fixed in Q1/2024." />
<meta property="og:description" content="Summary MrDocs Boost Libraries Boost Release Tools Boost Website C++ Github Actions MrDocs Over the last quarter, we continued our work on MrDocs, a documentation generator for C++ projects. I have been overseeing and reviewing all the work done by the other contributors to the project. Besides the work done by Krystian and Fernando, George H. (an author of https://github.com/hdoc/hdoc[HDoc]) also joined the project as a contributor. We have been working on making the project at least as competitive as the Doxygen with Docca we have been using with other libraries. The goal is to use it in a subset of Boost libraries that will also use Antora for their documentation. In this process, we have also been improving usability and documentation, considering the feedback we received. Features In particular, work in Q1/2024 included: Updating the LLVM version we have been using and adapting the project to the new version Updating CI workflows to use official releases for all dependencies, which is an essential step in the direction of making the project more stable for user instructions, CI, and standalone binaries Improve the documentation to provide more straightforward installation instructions and examples. New Antora plugins were included to make the documentation more interactive and easier to navigate. A new CI workflow that builds and caches LLVM from source, making it easier to update the LLVM versions and deprecate the old workflow that required manual intervention to update binaries on the MrDocs website Custom scripts and presets for dependencies that do not provide them, such as Duktape and LLVM Adjust CI to replicate the instructions in the documentation and vice-versa precisely. CMake Presets updated to improve the build time and reflect the documentation instructions Work on sanitizing references in Javadoc commands that need to know whether the first argument is an identifier. Clang often provides these references as simple text. Support for multi-node HTML tags: Clang represents several HTML tags by multiple nodes. MrDocs simply ignored these tags, but now they are correctly represented in the DOM. Support for several new Javadoc and (“throws”, “details”, “see”) HTML tags (“br”, “img”, “input”, “hr”, “meta”, “link”, “base”, “area”, “col”, “command”, “embed”, “keygen”, “param”, “source”, “track”, “wbr”). These tags were already present in the Boost.URL documentation, but MrDocs did not support them. Simplify the ASTVisitor by generalizing the traverse function. Provide demos with their mrdocs.yml files and use them instead of generating new ones. This change allows the projects to handle their custom parameters instead of relying on the global configuration. Support input filters to include or exclude files according to their paths. Create a bash argument parser so that mrdocs.yml parameters that represent CMake options can use the same syntax used to call CMake from the command line. Support for automatic CMake execution by MrDocs to generate the compile_commands.json file. This feature was implemented over many commits. Support for C source files. Filter sanitizer flags in the command database. A number of improvements to the C++ Actions project directed at benefiting MrDocs. Dozens of minor bug fixes and improvements to the implementation Binaries While working on these concrete issues, I have also explored strategies to generate stable standalone binaries for MrDocs. The motivation is that it is time-consuming to build MrDocs, so the way MrDocs is supposed to be most commonly used is with scripts that download portable executables and run the tool. These scripts will usually be run in CI on some Ubuntu-X container. The problem is we are using recent versions of Ubuntu (Ubuntu 23.04 now) to originally build MrDocs because of the C++ features we need. However, users (including the Boost Release Tools) usually use earlier versions of Ubuntu (usually from 18.04 to 22.04) for various reasons. Binaries built on Ubuntu X (say 23.04) does not work under Ubuntu &lt;X (say 20.04). For this reason, we need to provide portable executables that people can use. I have researched many complex strategies to solve the problem and have been experimenting with each of them for weeks. Solutions based on -static/-static-libgcc did not work because they still depend on the kernel for libc. Using musl also did not work because using Musl with C++ is complex, and there needs to be a toolchain for the compilers we need. The latest C++/Musl toolchain is GCC 11. Cosmopolitan turned out to be inappropriate for our needs. It is very experimental and attempts to be much more general than we need. GCC -ffreestanding compile mode limits the standard libraries available, which is not an option for MrDocs. A combination of MrDocs downgrading Ubuntu and Boost release tools upgrading Ubuntu. We have already implemented that, but the solution is still not portable enough for Boost let alone other workflows. There is also a limit on how much we can downgrade Ubuntu because of the C++ features we need. For instance, downgrading to 20.04 would require us to compile another compiler from source before building MrDocs: this is overly complex, hard to maintain, slow to test, not general enough, and just failed to work in practice. ApBuild (a gcc wrapper that enforces GLIB_C version and does a few other binary compatibility tricks) was a solution somewhat similar to a wrapper overriding system libraries (see below). However, it has not been maintained , and a custom wrapper is likely to work better. The solution I’m currently exploring is a wrapper overriding system libs. Considering the limitations of the other ideas we have tried, I will explore a strategy similar to APBuild, but one that is manual and more stable. It is also similar to how CMake provides its binaries. It consists of patching the release so that: The libraries required by MrDocs are identified and bundled with the MrDocs release in subdirectories of lib bin/mrdocs is renamed mrdocs.real (or something to this end) A C wrapper is compiled to replace the original bin/mrdocs. This wrapper adjusts the library paths and calls mrdocs.real. It should be compiled with a very old version of GCC and Ubuntu. The wrapper can be compiled once or in CI. This wrapper approach has the following benefits: This wrapper also seemed like a complex solution at first, but it turned out to be much simpler and more effective than the other solutions we tried. It is easy to maintain. We can use the same logic and wrapper no matter what version of Ubuntu we initially used to compile MrDocs. This simplicity also means we have more freedom to upgrade the MrDocs toolchain and use more recent C++ standards. Testing is much easier because these binaries require no specific workflow. The releases would be a patched version of the same binaries we have produced. Also, it involves no custom-built compilers. It is a much more general solution. We can build MrDocs on Ubuntu 23.04 and use the release binaries on Ubuntu 16.04 if we have to. Integrations As Boost.URL keeps integrating MrDocs, it has been inspiring the features we need in MrDocs and is temporarily generating the documentation with both Doxygen+Docca and Antora+MrDocs. The same workflow has also been implemented in Boost.Buffers, which is now inspiring new feature requests, such as the identification of Niebloids and SFINAE constraints in the documentation. General work In general, I’ve been responsible in MrDocs for: setting up and maintaining CI for the project; MrDocs and LLVM release binaries; build scripts; setting up and integrating dependencies; setting up and deploying the Antora toolchains and documentation to the project website; working on supporting libraries; supervising and reviewing the work done by other contributors (Krystian, Fernando, and George H.); and fixing bugs. Handlebars The MrDocs also includes a support library that reimplements the Handlebars template engine in C++. This module is used to generate documentation from templates. The Handlebars library has achieved a stable state and is now used in MrDocs to generate the documentation. It includes C++/JavaScript bindings that work both ways so that users can provide helpers for their templates. We may consider splitting Handlebars into a separate project. Boost Libraries As in other quarters, the Boost Library I have been investing most of my time in is Boost.URL. The library is in maintenance mode since our focus shifted to MrDocs, but there is a constant demand for work fixing bugs and improving the documentation: Multiple commits related to the Antora+MrDocs workflow. Many new tests have been included to improve the library’s coverage, which is now at 99%. Dozens of minor bug fixes and improvements to the implementation, documentation, and CI workflows Many improvements had to be coordinated with the C++ Github Actions project, which implemented new features for these use cases. Many bugs in the actions were also revealed by Boost.HTTP now uses the actions in its CI. In general, I have been responsible for: upgrading CI, primarily coordinating with the C++ Github Actions; maintaining, simplifying, and updating build scripts; integrating more spec tests, such as the Ada tests included more recently; including more examples, such as the more recent sanitize-URL example; fixing documentation content out of date; and fixing bugs. Besides Boost.URL, as usual, I have been overseeing and fixing smaller issues with other boost libraries. I have been also helping Boost.HTTP and Boost.Buffers in their efforts to improve CI and integrate MrDocs. Boost Release Tools I have been working on the integration of toolchains I developed into the Boost Release Tools to add support for features desired for the new Boost website. We needed many improvements to the workflow for Antora support in the release tools, as bugs and inconveniences have been identified since the official Boost release 1.84.0. Antora directories are now patched and moved to another location. We also kept working on an initiative to support archive variants in the release tools. This pull request is still under review and will be considered for inclusion in a period between Boost releases when priority moves from the Boost website. Boost Website Among the many support projects for the new Boost website, I have been helping the most on website-v2-docs, which includes the Boost website documentation as an Antora project. Its components represent the website’s “User Guide,” “Contributor Guide,” and “Formal Review” sections. Since the beginning of the project, I have been overseeing and reviewing the work of the other contributors. In general, I continue to be responsible for: reviewing and merging all pull requests to the project; setting up and maintaining CI for the project; coordinating with the website project on content uploaded to AWS buckets; build scripts to be reused by the release tools and previews; writing sections of the documentation that require technical knowledge; developing custom Boost/Antora extensions, such as the Boost Macro extension; maintaining the Antora toolchain and templates; and adjusted Boost libraries to match formats expected by the website. C++ Github Actions C++ Github Actions is a project I have maintained since 2023. It is a collection of composable, independent, and reusable GitHub Actions for any C++ project that needs to be tested on various compilers and environments. MrDocs, Boost.URL, Boost.HTTP, and Boost.Buffers are currently using these actions in their CI. All of these projects have been allowing us to get more feedback and improve the actions. The project includes actions to: Generate a Github Actions Matrix for C++ projects; Setup C++ compilers; Install and setup packages; Clone Boost modules; Run complete CMake and b2 workflows; Generate changelogs from conventional commits; Generate summaries; and Generate time-trace reports and flame graphs One notable problem with GitHub actions in Q1/2024 is that GitHub decided to update the base version of Node.js to 20. Because Node.Js is not statically linked, this change broke many actions that depended on it. All projects that depend on older containers now get an error related to the appropriate glic version not being found. Attempting to use older versions of Node.js still works temporarily, but it also emits a warning. This bug will need to be addressed in the future. In particular, a number of new features were added to the C++ Actions project in Q1 2024. Boost optimistic caching is now disabled by default. Caching is optional. Expressions in the main workflow to override these parameters. Cmake workflow includes a complete bash command line parser for the CMake arguments. It makes the workflow more reliable as commands are now properly passed through to CMake in a way that matches the user’s expectations. Cmake workflow supports combinatorial variants of extra arguments. For instance, this could be used in integration tests (as has been implemented in Boost.URL) where the same workflow is run with slightly different arguments. CMake setup is cached in the GitHub Actions tool cache. The binary is also added to PATH. All C++ Matrix suggestions are now customizable for ranges of compiler versions. This feature eliminates the need for expressions to override matrix options. C++ Matrix supports custom images. C++ Matrix has a new option for combinatorial factors. Unlike other factors that apply to the latest or an intermediary version of a toolset, combinatorial factors duplicate all entries for a compiler and set a new flag to identify that kind of test. For instance, it could be used to test clang with libc++ and libstdc++ in parallel for each clang version. C++ Matrix includes flags for intermediary compiler versions. These flags are handy when a test does not need to occur in intermediary versions of a compiler that have no unique factors applied to it. C++ Matrix supports composite factors. Composite factors allow two factors to be determined at once for a test. For instance, the factor TSan+Asan will set the flags for both TSan and Asan in the same test, with having to create a test for each. This type of factor is useful when the factors are mutually exclusive. The C++ Matrix uses containers by default when appropriate. In particular, this eliminates errors with Clang, which often picks up an uncommon version of stdlibc++ when running tests. This choice is often an incompatible version that does not represent the most common use case by the user. B2 workflow supports versioned toolsets. For instance, a toolset gcc-13 would appropriately set only gcc in user-config.jam while calling b2 with the appropriate complete flag. B2 workflow support for dozens of options specific to B2. These include options supported by B2 that do not apply to CMake: clean, clean-all, abbreviate-paths (default is true), hash, rebuild-all, dry-run, stop-on-error, config, site-config, user-config, project-config, debug-configuration, debug-building, debug-generators, include, define, and runtime-link. A number of these options have been necessary in other Boost projects using these actions. Package-Install supports add-architecture. Dozens of other minor improvements, bug fixes, and updates to the documentation. In addition to new features, most work has been done to fix issues revealed by testing the actions in new environments. About ~50 bugs with various levels of severity have been fixed in Q1/2024." />
<link rel="canonical" href="http://cppalliance.org/alan/2024/05/07/AlanQ1Update.html" />
<meta property="og:url" content="http://cppalliance.org/alan/2024/05/07/AlanQ1Update.html" />
<meta property="og:site_name" content="The C++ Alliance" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-05-07T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Making MrDocs Portable for Every Toolchain" />
<meta name="twitter:site" content="@CPPAlliance" />
<script type="application/ld+json">
{"description":"Summary MrDocs Boost Libraries Boost Release Tools Boost Website C++ Github Actions MrDocs Over the last quarter, we continued our work on MrDocs, a documentation generator for C++ projects. I have been overseeing and reviewing all the work done by the other contributors to the project. Besides the work done by Krystian and Fernando, George H. (an author of https://github.com/hdoc/hdoc[HDoc]) also joined the project as a contributor. We have been working on making the project at least as competitive as the Doxygen with Docca we have been using with other libraries. The goal is to use it in a subset of Boost libraries that will also use Antora for their documentation. In this process, we have also been improving usability and documentation, considering the feedback we received. Features In particular, work in Q1/2024 included: Updating the LLVM version we have been using and adapting the project to the new version Updating CI workflows to use official releases for all dependencies, which is an essential step in the direction of making the project more stable for user instructions, CI, and standalone binaries Improve the documentation to provide more straightforward installation instructions and examples. New Antora plugins were included to make the documentation more interactive and easier to navigate. A new CI workflow that builds and caches LLVM from source, making it easier to update the LLVM versions and deprecate the old workflow that required manual intervention to update binaries on the MrDocs website Custom scripts and presets for dependencies that do not provide them, such as Duktape and LLVM Adjust CI to replicate the instructions in the documentation and vice-versa precisely. CMake Presets updated to improve the build time and reflect the documentation instructions Work on sanitizing references in Javadoc commands that need to know whether the first argument is an identifier. Clang often provides these references as simple text. Support for multi-node HTML tags: Clang represents several HTML tags by multiple nodes. MrDocs simply ignored these tags, but now they are correctly represented in the DOM. Support for several new Javadoc and (“throws”, “details”, “see”) HTML tags (“br”, “img”, “input”, “hr”, “meta”, “link”, “base”, “area”, “col”, “command”, “embed”, “keygen”, “param”, “source”, “track”, “wbr”). These tags were already present in the Boost.URL documentation, but MrDocs did not support them. Simplify the ASTVisitor by generalizing the traverse function. Provide demos with their mrdocs.yml files and use them instead of generating new ones. This change allows the projects to handle their custom parameters instead of relying on the global configuration. Support input filters to include or exclude files according to their paths. Create a bash argument parser so that mrdocs.yml parameters that represent CMake options can use the same syntax used to call CMake from the command line. Support for automatic CMake execution by MrDocs to generate the compile_commands.json file. This feature was implemented over many commits. Support for C source files. Filter sanitizer flags in the command database. A number of improvements to the C++ Actions project directed at benefiting MrDocs. Dozens of minor bug fixes and improvements to the implementation Binaries While working on these concrete issues, I have also explored strategies to generate stable standalone binaries for MrDocs. The motivation is that it is time-consuming to build MrDocs, so the way MrDocs is supposed to be most commonly used is with scripts that download portable executables and run the tool. These scripts will usually be run in CI on some Ubuntu-X container. The problem is we are using recent versions of Ubuntu (Ubuntu 23.04 now) to originally build MrDocs because of the C++ features we need. However, users (including the Boost Release Tools) usually use earlier versions of Ubuntu (usually from 18.04 to 22.04) for various reasons. Binaries built on Ubuntu X (say 23.04) does not work under Ubuntu &lt;X (say 20.04). For this reason, we need to provide portable executables that people can use. I have researched many complex strategies to solve the problem and have been experimenting with each of them for weeks. Solutions based on -static/-static-libgcc did not work because they still depend on the kernel for libc. Using musl also did not work because using Musl with C++ is complex, and there needs to be a toolchain for the compilers we need. The latest C++/Musl toolchain is GCC 11. Cosmopolitan turned out to be inappropriate for our needs. It is very experimental and attempts to be much more general than we need. GCC -ffreestanding compile mode limits the standard libraries available, which is not an option for MrDocs. A combination of MrDocs downgrading Ubuntu and Boost release tools upgrading Ubuntu. We have already implemented that, but the solution is still not portable enough for Boost let alone other workflows. There is also a limit on how much we can downgrade Ubuntu because of the C++ features we need. For instance, downgrading to 20.04 would require us to compile another compiler from source before building MrDocs: this is overly complex, hard to maintain, slow to test, not general enough, and just failed to work in practice. ApBuild (a gcc wrapper that enforces GLIB_C version and does a few other binary compatibility tricks) was a solution somewhat similar to a wrapper overriding system libraries (see below). However, it has not been maintained , and a custom wrapper is likely to work better. The solution I’m currently exploring is a wrapper overriding system libs. Considering the limitations of the other ideas we have tried, I will explore a strategy similar to APBuild, but one that is manual and more stable. It is also similar to how CMake provides its binaries. It consists of patching the release so that: The libraries required by MrDocs are identified and bundled with the MrDocs release in subdirectories of lib bin/mrdocs is renamed mrdocs.real (or something to this end) A C wrapper is compiled to replace the original bin/mrdocs. This wrapper adjusts the library paths and calls mrdocs.real. It should be compiled with a very old version of GCC and Ubuntu. The wrapper can be compiled once or in CI. This wrapper approach has the following benefits: This wrapper also seemed like a complex solution at first, but it turned out to be much simpler and more effective than the other solutions we tried. It is easy to maintain. We can use the same logic and wrapper no matter what version of Ubuntu we initially used to compile MrDocs. This simplicity also means we have more freedom to upgrade the MrDocs toolchain and use more recent C++ standards. Testing is much easier because these binaries require no specific workflow. The releases would be a patched version of the same binaries we have produced. Also, it involves no custom-built compilers. It is a much more general solution. We can build MrDocs on Ubuntu 23.04 and use the release binaries on Ubuntu 16.04 if we have to. Integrations As Boost.URL keeps integrating MrDocs, it has been inspiring the features we need in MrDocs and is temporarily generating the documentation with both Doxygen+Docca and Antora+MrDocs. The same workflow has also been implemented in Boost.Buffers, which is now inspiring new feature requests, such as the identification of Niebloids and SFINAE constraints in the documentation. General work In general, I’ve been responsible in MrDocs for: setting up and maintaining CI for the project; MrDocs and LLVM release binaries; build scripts; setting up and integrating dependencies; setting up and deploying the Antora toolchains and documentation to the project website; working on supporting libraries; supervising and reviewing the work done by other contributors (Krystian, Fernando, and George H.); and fixing bugs. Handlebars The MrDocs also includes a support library that reimplements the Handlebars template engine in C++. This module is used to generate documentation from templates. The Handlebars library has achieved a stable state and is now used in MrDocs to generate the documentation. It includes C++/JavaScript bindings that work both ways so that users can provide helpers for their templates. We may consider splitting Handlebars into a separate project. Boost Libraries As in other quarters, the Boost Library I have been investing most of my time in is Boost.URL. The library is in maintenance mode since our focus shifted to MrDocs, but there is a constant demand for work fixing bugs and improving the documentation: Multiple commits related to the Antora+MrDocs workflow. Many new tests have been included to improve the library’s coverage, which is now at 99%. Dozens of minor bug fixes and improvements to the implementation, documentation, and CI workflows Many improvements had to be coordinated with the C++ Github Actions project, which implemented new features for these use cases. Many bugs in the actions were also revealed by Boost.HTTP now uses the actions in its CI. In general, I have been responsible for: upgrading CI, primarily coordinating with the C++ Github Actions; maintaining, simplifying, and updating build scripts; integrating more spec tests, such as the Ada tests included more recently; including more examples, such as the more recent sanitize-URL example; fixing documentation content out of date; and fixing bugs. Besides Boost.URL, as usual, I have been overseeing and fixing smaller issues with other boost libraries. I have been also helping Boost.HTTP and Boost.Buffers in their efforts to improve CI and integrate MrDocs. Boost Release Tools I have been working on the integration of toolchains I developed into the Boost Release Tools to add support for features desired for the new Boost website. We needed many improvements to the workflow for Antora support in the release tools, as bugs and inconveniences have been identified since the official Boost release 1.84.0. Antora directories are now patched and moved to another location. We also kept working on an initiative to support archive variants in the release tools. This pull request is still under review and will be considered for inclusion in a period between Boost releases when priority moves from the Boost website. Boost Website Among the many support projects for the new Boost website, I have been helping the most on website-v2-docs, which includes the Boost website documentation as an Antora project. Its components represent the website’s “User Guide,” “Contributor Guide,” and “Formal Review” sections. Since the beginning of the project, I have been overseeing and reviewing the work of the other contributors. In general, I continue to be responsible for: reviewing and merging all pull requests to the project; setting up and maintaining CI for the project; coordinating with the website project on content uploaded to AWS buckets; build scripts to be reused by the release tools and previews; writing sections of the documentation that require technical knowledge; developing custom Boost/Antora extensions, such as the Boost Macro extension; maintaining the Antora toolchain and templates; and adjusted Boost libraries to match formats expected by the website. C++ Github Actions C++ Github Actions is a project I have maintained since 2023. It is a collection of composable, independent, and reusable GitHub Actions for any C++ project that needs to be tested on various compilers and environments. MrDocs, Boost.URL, Boost.HTTP, and Boost.Buffers are currently using these actions in their CI. All of these projects have been allowing us to get more feedback and improve the actions. The project includes actions to: Generate a Github Actions Matrix for C++ projects; Setup C++ compilers; Install and setup packages; Clone Boost modules; Run complete CMake and b2 workflows; Generate changelogs from conventional commits; Generate summaries; and Generate time-trace reports and flame graphs One notable problem with GitHub actions in Q1/2024 is that GitHub decided to update the base version of Node.js to 20. Because Node.Js is not statically linked, this change broke many actions that depended on it. All projects that depend on older containers now get an error related to the appropriate glic version not being found. Attempting to use older versions of Node.js still works temporarily, but it also emits a warning. This bug will need to be addressed in the future. In particular, a number of new features were added to the C++ Actions project in Q1 2024. Boost optimistic caching is now disabled by default. Caching is optional. Expressions in the main workflow to override these parameters. Cmake workflow includes a complete bash command line parser for the CMake arguments. It makes the workflow more reliable as commands are now properly passed through to CMake in a way that matches the user’s expectations. Cmake workflow supports combinatorial variants of extra arguments. For instance, this could be used in integration tests (as has been implemented in Boost.URL) where the same workflow is run with slightly different arguments. CMake setup is cached in the GitHub Actions tool cache. The binary is also added to PATH. All C++ Matrix suggestions are now customizable for ranges of compiler versions. This feature eliminates the need for expressions to override matrix options. C++ Matrix supports custom images. C++ Matrix has a new option for combinatorial factors. Unlike other factors that apply to the latest or an intermediary version of a toolset, combinatorial factors duplicate all entries for a compiler and set a new flag to identify that kind of test. For instance, it could be used to test clang with libc++ and libstdc++ in parallel for each clang version. C++ Matrix includes flags for intermediary compiler versions. These flags are handy when a test does not need to occur in intermediary versions of a compiler that have no unique factors applied to it. C++ Matrix supports composite factors. Composite factors allow two factors to be determined at once for a test. For instance, the factor TSan+Asan will set the flags for both TSan and Asan in the same test, with having to create a test for each. This type of factor is useful when the factors are mutually exclusive. The C++ Matrix uses containers by default when appropriate. In particular, this eliminates errors with Clang, which often picks up an uncommon version of stdlibc++ when running tests. This choice is often an incompatible version that does not represent the most common use case by the user. B2 workflow supports versioned toolsets. For instance, a toolset gcc-13 would appropriately set only gcc in user-config.jam while calling b2 with the appropriate complete flag. B2 workflow support for dozens of options specific to B2. These include options supported by B2 that do not apply to CMake: clean, clean-all, abbreviate-paths (default is true), hash, rebuild-all, dry-run, stop-on-error, config, site-config, user-config, project-config, debug-configuration, debug-building, debug-generators, include, define, and runtime-link. A number of these options have been necessary in other Boost projects using these actions. Package-Install supports add-architecture. Dozens of other minor improvements, bug fixes, and updates to the documentation. In addition to new features, most work has been done to fix issues revealed by testing the actions in new environments. About ~50 bugs with various levels of severity have been fixed in Q1/2024.","@type":"BlogPosting","url":"http://cppalliance.org/alan/2024/05/07/AlanQ1Update.html","headline":"Making MrDocs Portable for Every Toolchain","dateModified":"2024-05-07T00:00:00+00:00","datePublished":"2024-05-07T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://cppalliance.org/alan/2024/05/07/AlanQ1Update.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->



<link href="/css/prism.css" rel="stylesheet">


<link href='/feed.xml' rel='alternate' type='application/atom+xml'>

<!-- Twitter Card Start -->




  
    <meta name="twitter:image" content="https://cppalliance.org/images/logo.png">
  

<!-- Twitter Card End -->

<script defer data-domain="cppalliance.org" src="https://plausible.io/js/script.js"></script>

</head>

<body id='body' class="line-numbers">

  <!-- Navigation -->
  <nav class='nav dark'>
    <a href='/'>
      <img class='logo' alt='cpp-alliance-logo' src='/images/logo.svg' />
    </a>
    <div class='hamburger' id='nav-hamburger'>
      <span class='hamburger-line'></span>
      <span class='hamburger-line'></span>
      <span class='hamburger-line'></span>
    </div>
    <div class='nav-items' id='nav-items'>
      <div class="nav-item"><a class="nav-link nav-link-mobile" href="/">Home</a></div>
      <div class="nav-item"><a class="nav-link nav-link-mobile" href="/#mission">Mission</a></div>
      <div class="nav-item"><a class="nav-link nav-link-mobile" href="/#team">Team</a></div>
      <div class="nav-item"><a class="nav-link nav-link-mobile" href="/#news">News</a></div>
      <div class="nav-item"><a class="nav-link nav-link-mobile" href="/#links">Links</a></div>
      <div class="nav-item"><a class="nav-link nav-link-mobile" href="/#faq">FAQ</a></div>
      <div class="nav-item"><a class="nav-link nav-link-mobile" href="/#contact">Contact</a></div>
      <div class='socials'>
        <div class='connect-content'>
          <div class='row row-sm'>
            <div class='col-fourth col-fourth-sm social-link'>
              <a class='social-icon nav-link-mobile' href="https://github.com/CPPAlliance">
                <div class='social-icon-img-wrapper'>
                  <img class='social-icon-img github' alt='github-logo' src='/images/icons/github.svg' />
                </div>
                <span class='social-icon-text'>GitHub</span>
              </a>
            </div>
            <div class='col-fourth col-fourth-sm social-link'>
              <a class='social-icon nav-link-mobile' href="https://www.facebook.com/CPPAlliance/">
                <div class='social-icon-img-wrapper'>
                  <img class='social-icon-img facebook' alt='facebook-logo' src='/images/icons/facebook.svg' />
                </div>
                <span class='social-icon-text'>Facebook</span>
              </a>
            </div>
            <div class='col-fourth col-fourth-sm social-link'>
              <a class='social-icon nav-link-mobile' href="https://x.com/cppalliance">
                <div class='social-icon-img-wrapper'>
                  <img class='social-icon-img twitter' alt='x-logo' src='/images/icons/twitter.svg' />
                </div>
                <span class='social-icon-text'>X</span>
              </a>
            </div>
            <div class='col-fourth col-fourth-sm social-link'>
              <a class='social-icon nav-link-mobile' href="https://www.linkedin.com/in/cppalliance/">
                <div class='social-icon-img-wrapper'>
                  <img class='social-icon-img linkedin' alt='linkedin-logo' src='/images/icons/linkedin.svg' />
                </div>
                <span class='social-icon-text'>LinkedIn</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>






  <div class='post'>
  <div class='current-article'>
    

    <section class='section article'>
      

      <article>
      <div class="title-section center">
        <h2 class='text-l news-title no-border'>Making MrDocs Portable for Every Toolchain</h2>
        
        
                
                
                
                  
                
                  
                
                  
                
                  
                    
                    
        

        

        
          <div class='author d-iblock'>
            <a class='link author-img-link' href="/people/alan">
              <img class='author-img' src='/images/people/alan.jpg' alt='Portrait of Alan de Freitas' />
            </a>
            <span class='text-xxs author-name'>
                <a class='link' href="/people/alan">
                  Alan de Freitas
                </a> &middot; May 7, 2024
            </span>
          </div>
        
      </div>
        <div class='text-xxs content-text generated-content'>
          <h1 id="summary">Summary</h1>

<ul>
  <li><a href="#mrdocs">MrDocs</a></li>
  <li><a href="#boost-libraries">Boost Libraries</a></li>
  <li><a href="#boost-release-tools">Boost Release Tools</a></li>
  <li><a href="#boost-website">Boost Website</a></li>
  <li><a href="#c-github-actions">C++ Github Actions</a></li>
</ul>

<h2 id="mrdocs">MrDocs</h2>

<p>Over the last quarter, we continued our work on <a href="https://github.com/cppalliance/mrdocs">MrDocs</a>, a
documentation generator for C++ projects. I have been overseeing and reviewing all the work done by the other
contributors
to the project. Besides the work done by Krystian and Fernando, George H. (an author
of https://github.com/hdoc/hdoc[HDoc])
also joined the project as a contributor.</p>

<p>We have been working on making the project at least as competitive as the <a href="https://www.doxygen.nl/">Doxygen</a> with
<a href="https://github.com/boostorg/docca">Docca</a> we have been using with other libraries. The goal is to use it in a
subset of Boost libraries that will also use <a href="https://antora.org/">Antora</a> for their documentation.
In this process, we have also been improving usability and documentation, considering the feedback we received.</p>

<h3 id="features">Features</h3>

<p>In particular, work in Q1/2024 included:</p>

<ul>
  <li>Updating the LLVM version we have been using and adapting the project to the new version</li>
  <li>Updating CI workflows to use official releases for all dependencies, which is an essential step in the direction of
making the project more stable for user instructions, CI, and standalone binaries</li>
  <li>Improve the documentation to provide more straightforward installation instructions and examples.</li>
  <li>New Antora plugins were included to make the documentation more interactive and easier to navigate.</li>
  <li>A new CI workflow that builds and caches LLVM from source, making it easier to update the LLVM versions and
deprecate the old workflow that required manual intervention to update binaries on the MrDocs website</li>
  <li>Custom scripts and presets for dependencies that do not provide them, such as Duktape and LLVM</li>
  <li>Adjust CI to replicate the instructions in the documentation and vice-versa precisely.</li>
  <li>CMake Presets updated to improve the build time and reflect the documentation instructions</li>
  <li>Work on sanitizing references in Javadoc commands that need to know whether the first argument is an identifier.
Clang often provides these references as simple text.</li>
  <li>Support for multi-node HTML tags: Clang represents several HTML tags by multiple nodes. MrDocs simply ignored these
tags, but now they are correctly represented in the DOM.</li>
  <li>Support for several new Javadoc and (“throws”, “details”, “see”) HTML tags (“br”, “img”, “input”, “hr”,
“meta”, “link”, “base”, “area”, “col”, “command”, “embed”, “keygen”, “param”, “source”, “track”, “wbr”). These tags
were already present in the Boost.URL documentation, but MrDocs did not support them.</li>
  <li>Simplify the ASTVisitor by generalizing the traverse function.</li>
  <li>Provide demos with their mrdocs.yml files and use them instead of generating new ones. This change allows the
projects to handle their custom parameters instead of relying on the global configuration.</li>
  <li>Support input filters to include or exclude files according to their paths.</li>
  <li>Create a bash argument parser so that mrdocs.yml parameters that represent CMake options can use the
same syntax used to call CMake from the command line.</li>
  <li>Support for automatic CMake execution by MrDocs to generate the <code>compile_commands.json</code> file. This feature was
implemented over many commits.</li>
  <li>Support for C source files.</li>
  <li>Filter sanitizer flags in the command database.</li>
  <li>A number of improvements to the <a href="#c-github-actions">C++ Actions</a> project directed at benefiting MrDocs.</li>
  <li>Dozens of minor bug fixes and improvements to the implementation</li>
</ul>

<h3 id="binaries">Binaries</h3>

<p>While working on these concrete issues, I have also explored strategies to generate stable standalone binaries
for MrDocs. The motivation is that it is time-consuming to build MrDocs, so the way MrDocs is supposed to be most
commonly used is with scripts that download portable executables and run the tool. These scripts will usually be run
in CI on some Ubuntu-X container.</p>

<p>The problem is we are using recent versions of Ubuntu (Ubuntu 23.04 now) to originally build MrDocs because of the C++
features we need. However, users (including the <a href="https://github.com/boostorg/release-tools">Boost Release Tools</a>)
usually use earlier versions of Ubuntu (usually from 18.04 to 22.04) for various reasons. Binaries built on
Ubuntu X (say 23.04) does not work under Ubuntu &lt;X (say 20.04). For this reason, we need to provide portable executables
that people can use.</p>

<p>I have researched many complex strategies to solve the problem and have been experimenting with each of them
for weeks.</p>

<ul>
  <li>Solutions based on <code>-static</code>/<code>-static-libgcc</code> did not work because they still depend on the kernel for libc.</li>
  <li>Using <a href="https://wiki.musl-libc.org/">musl</a> also did not work because using Musl with C++ is complex, and there needs to
be a
toolchain for the compilers we need. The latest C++/Musl toolchain is GCC 11.</li>
  <li><a href="https://github.com/jart/cosmopolitan">Cosmopolitan</a> turned out to be inappropriate for our needs. It is very
experimental and attempts to be much more general than we need.</li>
  <li>GCC <code>-ffreestanding</code> compile mode limits the standard libraries available, which is not an option for MrDocs.</li>
  <li>A combination of MrDocs downgrading Ubuntu and Boost release tools upgrading Ubuntu. We have already implemented that,
but
the solution is still not portable enough for Boost let alone other workflows. There is also a limit on how much we
can
downgrade Ubuntu because of the C++ features we need. For instance, downgrading to 20.04 would require us to compile
another compiler from source before building MrDocs: this is overly complex, hard to maintain, slow to test, not
general enough, and just failed to work in practice.</li>
  <li>ApBuild (a gcc wrapper that enforces GLIB_C version and does a few other binary compatibility tricks) was<br />
a solution somewhat similar to a wrapper overriding system libraries (see below). However, it has not been maintained
, and a custom wrapper is likely to work better.</li>
</ul>

<p>The solution I’m currently exploring
is <a href="https://blog.gibson.sh/2017/11/26/creating-portable-linux-binaries/#a-wrapper-that-selectively-overrides-system-libs">a wrapper overriding system libs</a>.
Considering the limitations of the other ideas we have tried, I will explore a strategy
similar to APBuild, but one that is manual and more stable. It is also similar to how CMake provides its binaries.
It consists of patching the release so that:</p>

<ul>
  <li>The libraries required by MrDocs are identified and bundled with the MrDocs release in subdirectories of <code>lib</code></li>
  <li><code>bin/mrdocs</code> is renamed <code>mrdocs.real</code> (or something to this end)</li>
  <li>A C wrapper is compiled to replace the original <code>bin/mrdocs</code>. This wrapper adjusts the library paths and calls
<code>mrdocs.real</code>. It should be compiled with a very old version of GCC and Ubuntu. The wrapper can be compiled once or
in CI.</li>
</ul>

<p>This wrapper approach has the following benefits:</p>

<ul>
  <li>This wrapper also seemed like a complex solution at first, but it turned out to be much simpler and more effective
than
the other solutions we tried.</li>
  <li>It is easy to maintain. We can use the same logic and wrapper no matter what version of Ubuntu we initially
used to compile MrDocs. This simplicity also means we have more freedom to upgrade the MrDocs toolchain and use more
recent C++
standards.</li>
  <li>Testing is much easier because these binaries require no specific workflow. The releases would be a patched version of
the same
binaries we have produced. Also, it involves no custom-built compilers.</li>
  <li>It is a much more general solution. We can build MrDocs on Ubuntu 23.04 and use the release binaries on Ubuntu 16.04
if
we have to.</li>
</ul>

<h3 id="integrations">Integrations</h3>

<p>As Boost.URL keeps integrating MrDocs, it has been inspiring the features we need in MrDocs and is temporarily
generating the documentation with both Doxygen+Docca and Antora+MrDocs. The same workflow has also been implemented
in <a href="https://github.com/cppalliance/buffers">Boost.Buffers</a>, which is now inspiring new feature requests, such
as the identification of <a href="https://github.com/cppalliance/mrdocs/issues/564">Niebloids</a> and
<a href="https://github.com/cppalliance/mrdocs/issues/565">SFINAE constraints</a> in the documentation.</p>

<h3 id="general-work">General work</h3>

<p>In general, I’ve been responsible in MrDocs for:</p>

<ul>
  <li>setting up and maintaining CI for the project;</li>
  <li>MrDocs and LLVM release binaries;</li>
  <li>build scripts;</li>
  <li>setting up and integrating dependencies;</li>
  <li>setting up and deploying the Antora toolchains and documentation to the project website;</li>
  <li>working on supporting libraries;</li>
  <li>supervising and reviewing the work done by other contributors (Krystian, Fernando, and George H.); and</li>
  <li>fixing bugs.</li>
</ul>

<h3 id="handlebars">Handlebars</h3>

<p>The MrDocs also includes a support library that reimplements the <a href="https://handlebarsjs.com/">Handlebars</a> template engine
in C++.
This module is used to generate documentation from templates. The Handlebars library has achieved a stable state and is
now used in
MrDocs to generate the documentation. It includes C++/JavaScript bindings that work both ways so that users can
provide helpers for their templates. We may consider splitting Handlebars into a separate project.</p>

<h2 id="boost-libraries">Boost Libraries</h2>

<p>As in other quarters, the Boost Library I have been investing most of my time
in is <a href="https://github.com/boostorg/url">Boost.URL</a>. The library is in maintenance mode since our focus shifted to
MrDocs,
but there is a constant demand for work fixing bugs and improving the documentation:</p>

<ul>
  <li>Multiple commits related to the Antora+MrDocs workflow.</li>
  <li>Many new tests have been included to improve the library’s coverage, which is now at 99%.</li>
  <li>Dozens of minor bug fixes and improvements to the implementation, documentation, and CI workflows</li>
</ul>

<p>Many improvements had to be coordinated with the <a href="#c-github-actions">C++ Github Actions</a> project, which implemented new
features for these use cases. Many bugs in the actions were also revealed by
<a href="https://github.com/cppalliance/http_proto">Boost.HTTP</a> now uses the actions in its CI.</p>

<p>In general, I have been responsible for:</p>

<ul>
  <li>upgrading CI, primarily coordinating with the <a href="#c-github-actions">C++ Github Actions</a>;</li>
  <li>maintaining, simplifying, and updating build scripts;</li>
  <li>integrating more spec tests, such as the Ada tests included more recently;</li>
  <li>including more examples, such as the more recent sanitize-URL example;</li>
  <li>fixing documentation content out of date; and</li>
  <li>fixing bugs.</li>
</ul>

<p>Besides Boost.URL, as usual, I have been overseeing and fixing smaller issues with other boost libraries. I have been
also helping <a href="https://github.com/cppalliance/http_proto">Boost.HTTP</a>
and <a href="https://github.com/cppalliance/buffers">Boost.Buffers</a>
in their efforts to improve CI and integrate MrDocs.</p>

<h2 id="boost-release-tools">Boost Release Tools</h2>

<p>I have been working on the integration of toolchains I developed into the Boost Release Tools to add support for
features
desired for the new Boost website.</p>

<p>We needed many improvements to the workflow for Antora support in the release tools, as bugs and inconveniences
have been identified since the official Boost release 1.84.0. Antora directories are now patched and moved to another
location.</p>

<p>We also kept working on an initiative to support archive variants in the release tools. This pull request is
still under review and will be considered for inclusion in a period between Boost releases when priority
moves from the <a href="#boost-website">Boost website</a>.</p>

<h2 id="boost-website">Boost Website</h2>

<p>Among the many support projects for the new Boost website, I have been helping the most on
<a href="https://github.com/boostorg/website-v2-docs"><code>website-v2-docs</code></a>, which includes the Boost website documentation as
an Antora project.
Its components represent the website’s “User Guide,” “Contributor Guide,” and “Formal Review” sections.</p>

<p>Since the beginning of the project, I have been overseeing and reviewing the work of the other contributors.</p>

<p>In general, I continue to be responsible for:</p>

<ul>
  <li>reviewing and merging all pull requests to the project;</li>
  <li>setting up and maintaining CI for the project;</li>
  <li>coordinating with the website project on content uploaded to AWS buckets;</li>
  <li>build scripts to be reused by the release tools and previews;</li>
  <li>writing sections of the documentation that require technical knowledge;</li>
  <li>developing custom Boost/Antora extensions, such as the Boost Macro extension;</li>
  <li>maintaining the Antora toolchain and templates; and</li>
  <li>adjusted Boost libraries to match formats expected by the website.</li>
</ul>

<h2 id="c-github-actions">C++ Github Actions</h2>

<p><a href="https://github.com/alandefreitas/cpp-actions">C++ Github Actions</a> is a project I have maintained
since 2023. It is a collection of composable, independent, and reusable GitHub Actions for any C++ project
that needs to be tested on various compilers and environments.</p>

<p>MrDocs, Boost.URL, Boost.HTTP, and Boost.Buffers are currently using these actions in their CI. All of these projects
have been allowing us to get more feedback and improve the actions.</p>

<p>The project includes actions to:</p>

<ul>
  <li>Generate a Github Actions Matrix for C++ projects;</li>
  <li>Setup C++ compilers;</li>
  <li>Install and setup packages;</li>
  <li>Clone Boost modules;</li>
  <li>Run complete CMake and <code>b2</code> workflows;</li>
  <li>Generate changelogs from conventional commits;</li>
  <li>Generate summaries; and</li>
  <li>Generate time-trace reports and flame graphs</li>
</ul>

<p>One notable problem with GitHub actions in Q1/2024 is that GitHub decided to update the base version of Node.js to 20.
Because Node.Js is not statically linked, this change <a href="https://github.com/actions/setup-node/issues/922">broke</a> many
actions that depended on it. All projects that depend on older containers now get an error related to the appropriate
<code>glic</code> version not being found. Attempting to use older versions of Node.js still works temporarily, but it also emits
a warning. This <a href="https://github.com/actions/runner/issues/2906">bug</a> will need to be addressed in the
future.</p>

<p>In particular, a number of new features were added to the C++ Actions project in Q1 2024.</p>

<ul>
  <li>Boost optimistic caching is now disabled by default. Caching is optional.
Expressions in the main workflow to override these parameters.</li>
  <li>Cmake workflow includes a complete bash command line parser for the CMake arguments. It makes the workflow more
reliable as commands are now properly passed through to CMake in a way that matches the user’s expectations.</li>
  <li>Cmake workflow supports combinatorial variants of extra arguments. For instance, this could be used in integration
tests (as has been implemented in Boost.URL) where the same workflow is run with slightly different arguments.</li>
  <li>CMake setup is cached in the GitHub Actions tool cache. The binary is also added to PATH.</li>
  <li>All C++ Matrix suggestions are now customizable for ranges of compiler versions. This feature eliminates the need for
expressions to override matrix options.</li>
  <li>C++ Matrix supports custom images.</li>
  <li>C++ Matrix has a new option for combinatorial factors. Unlike other factors that apply to the latest or an
intermediary version of a toolset, combinatorial factors duplicate all entries for a compiler and set a new flag
to identify that kind of test. For instance, it could be used to test clang with libc++ and libstdc++ in parallel
for each clang version.</li>
  <li>C++ Matrix includes flags for intermediary compiler versions. These flags are handy when a test does not need
to occur in intermediary versions of a compiler that have no unique factors applied to it.</li>
  <li>C++ Matrix supports composite factors. Composite factors allow two factors to be determined at once for a test.
For instance, the factor <code>TSan+Asan</code> will set the flags for both TSan and Asan in the same test, with having to create
a test for each. This type of factor is useful when the factors are mutually exclusive.</li>
  <li>The C++ Matrix uses containers by default when appropriate. In particular, this eliminates errors with Clang, which
often picks up an uncommon version of stdlibc++ when running tests. This choice is often an incompatible version that
does not
represent the most common use case by the user.</li>
  <li>B2 workflow supports versioned toolsets. For instance, a toolset <code>gcc-13</code> would appropriately set only <code>gcc</code> in
<code>user-config.jam</code> while calling <code>b2</code> with the appropriate complete flag.</li>
  <li>B2 workflow support for dozens of options specific to B2. These include options supported by B2 that do not apply to
CMake: <code>clean</code>, <code>clean-all</code>, <code>abbreviate-paths</code> (default is <code>true</code>), <code>hash</code>, <code>rebuild-all</code>, <code>dry-run</code>,
<code>stop-on-error</code>, <code>config</code>, <code>site-config</code>, <code>user-config</code>, <code>project-config</code>, <code>debug-configuration</code>, <code>debug-building</code>,
<code>debug-generators</code>, <code>include</code>, <code>define</code>, and <code>runtime-link</code>. A number of these options have been necessary in other
Boost projects using these actions.</li>
  <li>Package-Install supports <code>add-architecture</code>.</li>
  <li>Dozens of other minor improvements, bug fixes, and updates to the documentation.</li>
</ul>

<p>In addition to new features, most work has been done to fix issues revealed by testing the actions in new environments.
About ~50 bugs with various levels of severity have been fixed in Q1/2024.</p>

        </div>
      </article>
    </section>
  </div>

  <section class="section news bottom-layout" id='news'>
    <div class='section-title'>
      <h2 class='header text-xl recent-post-header'>All Posts by This Author</h2>
    </div>
    <div class='news-content formatted-text'>
      <ul>
        
        
        
        
        
        
        
        
        
        
        <li class='news-list-item '>
          <span class='text-xs news-date'>10/28/2025</span>
          <a class='text-l news-title link' href="/alan/2025/10/28/Alan.html">From Prototype to Product: MrDocs in 2025</a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class='news-list-item '>
          <span class='text-xs news-date'>07/10/2025</span>
          <a class='text-l news-title link' href="/alan/2025/07/10/Alan.html">Bringing B2-Style Test Granularity to CMake</a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class='news-list-item '>
          <span class='text-xs news-date'>01/10/2025</span>
          <a class='text-l news-title link' href="/alan/2025/01/10/AlanQ4Update.html">Scaling Documentation Pipelines Across Boost Projects</a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class='news-list-item '>
          <span class='text-xs news-date'>07/13/2024</span>
          <a class='text-l news-title link' href="/alan/2024/07/13/AlanQ2Update.html">Operationalizing MrDocs Reference for the Boost Release Workflow</a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class='news-list-item '>
          <span class='text-xs news-date'>05/07/2024</span>
          <a class='text-l news-title link' href="/alan/2024/05/07/AlanQ1Update.html">Making MrDocs Portable for Every Toolchain</a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class='news-list-item '>
          <span class='text-xs news-date'>01/12/2024</span>
          <a class='text-l news-title link' href="/alan/2024/01/12/AlanQ4Update.html">Owning Handlebars: Custom Templates for Boost.URL</a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li class='news-list-item '>
          <span class='text-xs news-date'>10/27/2023</span>
          <a class='text-l news-title link' href="/alan/2023/10/27/AlanQ3Update.html">Building the MrDocs Reference Pipeline for Antora</a>
        </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <li>
          <a class='text-l all link' href="/news">View All Posts...</a>
        </li>
      </ul>
    </div>
  </section>

</div>


  <footer class='footer'>
    <p class='text-xxs footer-text'>
      <span class='line'>&copy; 2024 The C Plus Plus Alliance, Inc.</span>
      <span class='line'>Contact us at: <a href='mailto:%69%6E%66%6F@%63%70%70%61%6C%6C%69%61%6E%63%65.%6F%72%67'>info@cppalliance.org</a></span>
    </p>
  </footer>

  <!-- Bootstrap core JavaScript -->
  <script src='/js/main.js'></script>
  
  <script src='/js/prism.js'></script>
  

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-76438364-18', 'auto');
    ga('send', 'pageview');
  </script>

</body>
</html>
